From 3ca41ab9fd1f826b91e233458ad1414a8f29da69 Mon Sep 17 00:00:00 2001
From: 4m1g0 <casadelblanco@gmail.com>
Date: Sat, 7 Jan 2012 00:33:02 +0100
Subject: [PATCH 19/22] Upgrade-Pinacle-Exploit-Last-Boss

---
 null                                               |    6 ++++--
 .../UtgardePinnacle/instance_pinnacle.cpp          |   19 ++++++++++++++++++-
 2 files changed, 22 insertions(+), 3 deletions(-)

diff --git a/null b/null
index 94c944e..9d89627 100644
--- a/null
+++ b/null
@@ -1,2 +1,4 @@
-[master f7f4dc9] CrashFix-in-Map
- 2 files changed, 3 insertions(+), 3 deletions(-)
+[master 02b6129] Halloween-Wands
+ 5 files changed, 161 insertions(+), 3 deletions(-)
+ create mode 100644 sql/own/world_halloween_wands.sql
+ create mode 100644 src/server/scripts/Custom/spells_custom.cpp
diff --git a/src/server/scripts/Northrend/UtgardeKeep/UtgardePinnacle/instance_pinnacle.cpp b/src/server/scripts/Northrend/UtgardeKeep/UtgardePinnacle/instance_pinnacle.cpp
index c5bc235..ffe307c 100644
--- a/src/server/scripts/Northrend/UtgardeKeep/UtgardePinnacle/instance_pinnacle.cpp
+++ b/src/server/scripts/Northrend/UtgardeKeep/UtgardePinnacle/instance_pinnacle.cpp
@@ -109,7 +109,11 @@ public:
                 case BOSS_SVALA_SORROWGRAVE:  uiSvalaSorrowgrave = creature->GetGUID();  break;
                 case BOSS_GORTOK_PALEHOOF:    uiGortokPalehoof = creature->GetGUID();    break;
                 case BOSS_SKADI_RUTHLESS:     uiSkadiTheRuthless = creature->GetGUID();  break;
-                case BOSS_KING_YMIRON:        uiKingYmiron = creature->GetGUID();        break;
+                case BOSS_KING_YMIRON:
+                    uiKingYmiron = creature->GetGUID();
+                    creature->SetReactState(REACT_PASSIVE);
+                    creature->SetFlag(UNIT_FIELD_FLAGS, UNIT_FLAG_OOC_NOT_ATTACKABLE);
+                    break;
                 case MOB_FRENZIED_WORGEN:     uiFrenziedWorgen = creature->GetGUID();    break;
                 case MOB_RAVENOUS_FURBOLG:    uiRavenousFurbolg = creature->GetGUID();   break;
                 case MOB_MASSIVE_JORMUNGAR:   uiMassiveJormungar = creature->GetGUID();  break;
@@ -251,6 +255,19 @@ public:
 
             OUT_LOAD_INST_DATA_COMPLETE;
         }
+        void Update(uint32 diff){
+
+            if (!instance->HavePlayers())
+                return;
+
+            if ((GetData(DATA_SVALA_SORROWGRAVE_EVENT) == DONE) && (GetData(DATA_GORTOK_PALEHOOF_EVENT) == DONE) && (GetData(DATA_SKADI_THE_RUTHLESS_EVENT) == DONE)) {
+                if(Creature* pYmiron = instance->GetCreature(uiKingYmiron)){
+                    pYmiron->SetReactState(REACT_AGGRESSIVE);
+                    pYmiron->RemoveFlag(UNIT_FIELD_FLAGS, UNIT_FLAG_OOC_NOT_ATTACKABLE);
+                }
+            }
+        }
+
     };
 };
 
-- 
1.7.5.4

