From fd92cc1ed52aa83626edaef37b298d4e71a544d4 Mon Sep 17 00:00:00 2001
From: Souler <soulerhyd@gmail.com>
Date: Sat, 12 Mar 2011 19:17:09 +0100
Subject: [PATCH] HD 029. Pinaculo Utgarde: No es posible enfrentarse al
 ultimo boss sin haberse enfrentado antes a los bosses
 previos

Signed-off-by: Souler <soulerhyd@gmail.com>
---
 .../UtgardePinnacle/instance_pinnacle.cpp          |   19 ++++++++++++++++++-
 1 files changed, 18 insertions(+), 1 deletions(-)

diff --git a/src/server/scripts/Northrend/UtgardeKeep/UtgardePinnacle/instance_pinnacle.cpp b/src/server/scripts/Northrend/UtgardeKeep/UtgardePinnacle/instance_pinnacle.cpp
index 5dbd431..683cfd2 100644
--- a/src/server/scripts/Northrend/UtgardeKeep/UtgardePinnacle/instance_pinnacle.cpp
+++ b/src/server/scripts/Northrend/UtgardeKeep/UtgardePinnacle/instance_pinnacle.cpp
@@ -109,7 +109,11 @@ public:
                 case BOSS_SVALA_SORROWGRAVE:  uiSvalaSorrowgrave = creature->GetGUID();  break;
                 case BOSS_GORTOK_PALEHOOF:    uiGortokPalehoof = creature->GetGUID();    break;
                 case BOSS_SKADI_RUTHLESS:     uiSkadiTheRuthless = creature->GetGUID();  break;
-                case BOSS_KING_YMIRON:        uiKingYmiron = creature->GetGUID();        break;
+                case BOSS_KING_YMIRON:
+                    uiKingYmiron = creature->GetGUID();
+                    creature->SetReactState(REACT_PASSIVE);
+                    creature->SetFlag(UNIT_FIELD_FLAGS, UNIT_FLAG_OOC_NOT_ATTACKABLE);
+                    break;
                 case MOB_FRENZIED_WORGEN:     uiFrenziedWorgen = creature->GetGUID();    break;
                 case MOB_RAVENOUS_FURBOLG:    uiRavenousFurbolg = creature->GetGUID();   break;
                 case MOB_MASSIVE_JORMUNGAR:   uiMassiveJormungar = creature->GetGUID();  break;
@@ -251,6 +255,19 @@ public:
 
             OUT_LOAD_INST_DATA_COMPLETE;
         }
+        void Update(uint32 diff){
+
+            if (!instance->HavePlayers())
+                return;
+
+            if ((GetData(DATA_SVALA_SORROWGRAVE_EVENT) == DONE) && (GetData(DATA_GORTOK_PALEHOOF_EVENT) == DONE) && (GetData(DATA_SKADI_THE_RUTHLESS_EVENT) == DONE)) {
+                if(Creature* pYmiron = instance->GetCreature(uiKingYmiron)){
+                    pYmiron->SetReactState(REACT_AGGRESSIVE);
+                    pYmiron->RemoveFlag(UNIT_FIELD_FLAGS, UNIT_FLAG_OOC_NOT_ATTACKABLE);
+                }
+            }
+        }
+
     };
 };
 
-- 
1.7.5.4

