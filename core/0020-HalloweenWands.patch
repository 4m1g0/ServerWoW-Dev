From 28ba626016871f950ad1600d73eb678c9c0c139c Mon Sep 17 00:00:00 2001
From: 4m1g0 <casadelblanco@gmail.com>
Date: Sun, 30 Oct 2011 04:12:51 +0100
Subject: [PATCH] HalloweenWands

---
 sql/own/world_halloween_wands.sql           |    7 ++
 src/server/game/Scripting/ScriptLoader.cpp  |    5 +-
 src/server/scripts/Custom/CMakeLists.txt    |    1 +
 src/server/scripts/Custom/spells_custom.cpp |  147 +++++++++++++++++++++++++++
 4 files changed, 159 insertions(+), 1 deletions(-)
 create mode 100644 sql/own/world_halloween_wands.sql
 create mode 100644 src/server/scripts/Custom/spells_custom.cpp

diff --git a/sql/own/world_halloween_wands.sql b/sql/own/world_halloween_wands.sql
new file mode 100644
index 0000000..73b838c
--- /dev/null
+++ b/sql/own/world_halloween_wands.sql
@@ -0,0 +1,7 @@
+DELETE FROM `spell_script_names` WHERE spell_id IN (24720, 24717, 24718, 24719, 24737);
+INSERT INTO `spell_script_names` VALUES
+(24720, 'spell_halloween_wand'),
+(24717, 'spell_halloween_wand'),
+(24718, 'spell_halloween_wand'),
+(24719, 'spell_halloween_wand'),
+(24737, 'spell_halloween_wand');
diff --git a/src/server/game/Scripting/ScriptLoader.cpp b/src/server/game/Scripting/ScriptLoader.cpp
index 3cca84e..098c1ac 100755
--- a/src/server/game/Scripting/ScriptLoader.cpp
+++ b/src/server/game/Scripting/ScriptLoader.cpp
@@ -598,6 +598,9 @@ void AddSC_outdoorpvp_zm();
 // player
 void AddSC_chat_log();
 
+// custom
+void AddSC_spells_custom();
+
 #endif
 
 void AddScripts()
@@ -1237,6 +1240,6 @@ void AddCustomScripts()
 {
 #ifdef SCRIPTS
     /* This is where custom scripts should be added. */
-
+    AddSC_spells_custom();
 #endif
 }
diff --git a/src/server/scripts/Custom/CMakeLists.txt b/src/server/scripts/Custom/CMakeLists.txt
index 1570ca1..a02baf2 100644
--- a/src/server/scripts/Custom/CMakeLists.txt
+++ b/src/server/scripts/Custom/CMakeLists.txt
@@ -10,6 +10,7 @@
 
 set(scripts_STAT_SRCS
   ${scripts_STAT_SRCS}
+  Custom/spells_custom.cpp
 )
 
 message("  -> Prepared: Custom")
diff --git a/src/server/scripts/Custom/spells_custom.cpp b/src/server/scripts/Custom/spells_custom.cpp
new file mode 100644
index 0000000..4c178d5
--- /dev/null
+++ b/src/server/scripts/Custom/spells_custom.cpp
@@ -0,0 +1,147 @@
+/*
+ * Copyright (C) 2008-2011 ServerWoW <http://www.serverwow.com/>
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU General Public License as published by the
+ * Free Software Foundation; either version 2 of the License, or (at your
+ * option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ * FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
+ * more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program. If not, see <http://www.gnu.org/licenses/>.
+ */
+
+/* ScriptData
+Name: spells custom fixes
+%Complete: 100
+Comment: todos los hackfix para spell
+Category: customfix
+EndScriptData */
+
+#include "ScriptMgr.h"
+#include "Spell.h"
+
+
+enum HalloweenData
+{
+    SPELL_PIRATE_COSTUME_MALE = 24708,
+    SPELL_PIRATE_COSTUME_FEMALE = 24709,
+    SPELL_NINJA_COSTUME_MALE = 24711,
+    SPELL_NINJA_COSTUME_FEMALE = 24710,
+    SPELL_LEPER_GNOME_COSTUME_MALE = 24712,
+    SPELL_LEPER_GNOME_COSTUME_FEMALE = 24713,
+    SPELL_GHOST_COSTUME_MALE = 24735,
+    SPELL_GHOST_COSTUME_FEMALE = 24736,
+
+
+    SPELL_HALLOWEEN_WAND_PIRATE = 24717,
+    SPELL_HALLOWEEN_WAND_NINJA = 24718,
+    SPELL_HALLOWEEN_WAND_LEPER_GNOME = 24719,
+    SPELL_HALLOWEEN_WAND_RANDOM = 24720,
+    SPELL_HALLOWEEN_WAND_SKELETON = 24724,
+    SPELL_HALLOWEEN_WAND_WISP = 24733,
+    SPELL_HALLOWEEN_WAND_GHOST = 24737,
+    SPELL_HALLOWEEN_WAND_BAT = 24741,
+};
+
+
+class spell_halloween_wand : public SpellScriptLoader
+{
+public:
+    spell_halloween_wand() : SpellScriptLoader("spell_halloween_wand") {}
+
+    class spell_halloween_wand_SpellScript : public SpellScript
+    {
+        PrepareSpellScript(spell_halloween_wand_SpellScript)
+
+        bool Validate(SpellInfo const* /*spellEntry*/)
+        {
+            if (!sSpellMgr->GetSpellInfo(SPELL_PIRATE_COSTUME_MALE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_PIRATE_COSTUME_FEMALE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_NINJA_COSTUME_MALE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_NINJA_COSTUME_FEMALE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_LEPER_GNOME_COSTUME_MALE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_LEPER_GNOME_COSTUME_FEMALE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_GHOST_COSTUME_MALE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_GHOST_COSTUME_FEMALE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_HALLOWEEN_WAND_PIRATE))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_HALLOWEEN_WAND_NINJA))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_HALLOWEEN_WAND_LEPER_GNOME))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_HALLOWEEN_WAND_RANDOM))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_HALLOWEEN_WAND_SKELETON))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_HALLOWEEN_WAND_WISP))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_HALLOWEEN_WAND_GHOST))
+                return false;
+            if (!sSpellMgr->GetSpellInfo(SPELL_HALLOWEEN_WAND_BAT))
+                return false;
+            return true;
+        }
+
+        void HandleScriptEffect()
+        {
+            Unit* caster = GetCaster();
+            Unit* target = GetHitPlayer();
+
+            if (!caster || !target)
+                return;
+
+            uint32 spellId = 0;
+            uint8 gender = target->getGender();
+
+            switch (GetSpellInfo()->Id)
+            {
+                case SPELL_HALLOWEEN_WAND_LEPER_GNOME:
+                    spellId = gender ? SPELL_LEPER_GNOME_COSTUME_FEMALE : SPELL_LEPER_GNOME_COSTUME_MALE;
+                    break;
+                case SPELL_HALLOWEEN_WAND_PIRATE:
+                    spellId = gender ? SPELL_PIRATE_COSTUME_FEMALE : SPELL_PIRATE_COSTUME_MALE;
+                    break;
+                case SPELL_HALLOWEEN_WAND_GHOST:
+                    spellId = gender ? SPELL_GHOST_COSTUME_FEMALE : SPELL_GHOST_COSTUME_MALE;
+                    break;
+                case SPELL_HALLOWEEN_WAND_NINJA:
+                    spellId = gender ? SPELL_NINJA_COSTUME_FEMALE : SPELL_NINJA_COSTUME_MALE;
+                    break;
+                case SPELL_HALLOWEEN_WAND_RANDOM:
+                    spellId = RAND(SPELL_HALLOWEEN_WAND_PIRATE, SPELL_HALLOWEEN_WAND_NINJA, SPELL_HALLOWEEN_WAND_LEPER_GNOME, SPELL_HALLOWEEN_WAND_SKELETON, SPELL_HALLOWEEN_WAND_WISP, SPELL_HALLOWEEN_WAND_GHOST, SPELL_HALLOWEEN_WAND_BAT);
+                    break;
+            }
+            caster->CastSpell(target, spellId, true);
+        }
+
+        void Register()
+        {
+            AfterHit += SpellHitFn(spell_halloween_wand_SpellScript::HandleScriptEffect);
+        }
+    };
+
+    SpellScript* GetSpellScript() const
+    {
+        return new spell_halloween_wand_SpellScript();
+    }
+};
+
+
+
+void AddSC_spells_custom()
+{
+    new spell_halloween_wand();
+}
-- 
1.7.5.4

